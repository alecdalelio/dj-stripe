# dj-stripe 2.6.0 (2022-01-XX)

!!! attention

    It is not possible to upgrade to dj-stripe 2.6.0 from versions older than 2.3.0.
    To upgrade from an older version, first upgrade to `dj-stripe 2.3.0`.

## Release highlights

-   Support for Python 3.10 and Django 4.0.
-   New models: `Mandate`, `Payout`, `UsageRecordSummary`, `WebhookEndpoint (unused)`
-   Significant improvements and fixes to `Stripe Connect` features.
-   Fixed `Infinite` recursive fetch/update loop errors.
-   Storing `Stripe API keys` by adding them to the Admin is now supported.
    This allows for use of multiple Stripe API keys (`multiple Stripe accounts`).

## Deprecated features

-   The use of the old `jsonfield`-based `JSONField` is deprecated and support for it
    will be dropped in dj-stripe 2.8.0. `django.models.JSONField` is available since
    Django 3.1.0. To switch to the newer JSONFields, set `DJSTRIPE_USE_NATIVE_JSONFIELD`
    to `True`. A manual migration is necessary to convert existing databases.

## Breaking changes

-   Python 3.6 is no longer supported. The new minimum version of Python is 3.7.12.
-   Django 2.2 and 3.1 are no longer supported.
-   `DJSTRIPE_USE_NATIVE_JSONFIELD` now defaults to `True`. If you previously had it set
    to `False`, or did not have it set, you may want to explicitly set it to `False` in
    order to support a pre-existing database. A migration path will later be provided
    for this use case.

- `Settings` would need to be referenced as `import djstripe.settings.djstripe_settings.DEFAULT_STRIPE_API_VERSION` as opposed to `djstripe.settings.DEFAULT_STRIPE_API_VERSION`

- Setting `get_stripe_api_version()` has been replaced by `djstripe_settings.STRIPE_API_VERSION`.

- `Customer.subscribe()` method now accepts **only keyword arguments** like `items`, `price`, and `plan`. See [this example](https://dj-stripe.github.io/dj-stripe/usage/subscribing_customers/) for more information.

- It is no longer possible to directly import the djstripe `settings` module and reference the settings like so:

```python
# INCORRECT
from djstripe import settings
STRIPE_API_VERSION = settings.STRIPE_API_VERSION
```

Instead they would need to be referenced from the `djstripe_settings` settings container like so:

```python
# CORRECT
from djstripe.settings import djstripe_settings
STRIPE_API_VERSION = djstripe_settings.STRIPE_API_VERSION
```



## Other changes

-   The Stripe Account that triggered an Event is now available on the field
    `WebhookEventTrigger.stripe_trigger_account`.
-   Migrations have been optimized and should be faster.
-   dj-stripe now checks the apparent validity of API keys used and will raise
    `InvalidStripeAPIKey` if the API key looks completely incorrect.
-   Various improvements to `manage.py djstripe_sync_models`.
    - Data for `Connected Accounts` will get synced too.
-   `Customers` can now be subscribed to `multiple plans`.
